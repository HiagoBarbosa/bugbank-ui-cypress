name: CI/CD Cypress Cucumber

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main
  schedule:
    - cron: '0 8 * * 1-5'  # Executa de segunda a sexta 맙 08:00

  workflow_dispatch:  # Permite disparar manualmente com par칙metros
    inputs:
      test_tag:
        description: 'Tag do cen치rio a ser executado'
        required: false
        default: '@regression'
      browser:
        description: 'Navegador para rodar os testes'
        required: false
        default: 'chrome'

jobs:
  cypress-tests:
    runs-on: ubuntu-latest

    steps:
      - name: 游닌 Checkout do c칩digo
        uses: actions/checkout@v3

      - name: 游댢 Configurar Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: 游닍 Instalar depend칡ncias
        run: npm install

      - name: 游빍 Executar testes Cypress com Cucumber
        env:
          TEST_TAG: ${{ github.event.inputs.test_tag || '@regression' }}
          BROWSER: ${{ github.event.inputs.browser || 'chrome' }}
        run: |
          npx cypress run

      - name: 游늵 Gerar relat칩rio com Mochawesome
        run: npm run report:generate 

      - name: 游 Publicar relat칩rio no GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./cypress/reports 